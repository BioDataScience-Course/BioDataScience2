---
title: "R√©gression lin√©aire simple"
author: "Guyliann Engels & Philippe Grosjean"
description: "**SDD II Module1** Application des concepts li√©s la r√©gression lin√©aire simple."
tutorial:
  id: "B01Lb_reglin1"
  version: 2.1.1/10
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
BioDataScience2::learnr_setup()
SciViews::R()
```

```{r, echo=FALSE}
BioDataScience2::learnr_banner()
```

```{r, context="server"}
BioDataScience2::learnr_server(input, output, session)
```

----

## Objectifs

- Revoir la corr√©lation et les indices de Pearson et Spearman
- Ma√Ætriser la r√©gression lin√©aire dans R, en particulier la fonction `lm()`.

## Corr√©lation 

```{r correlation-init}
set.seed(43)
# duplicated chunk : correlation-init
min <- 5
max <- 15

df <- tibble(
  x = seq(from = min, to = max, by = 0.25),
  y = x*2 + rnorm(sd= 0.5, n = length(x)),
  z = 2^x + rnorm(sd= 50, n = length(x)),
  a = sin(x) + rnorm(sd = 0.25,  n = length(x)),
  id = paste0("A", 1:length(x))
)
```

Vous avez √† disposition le jeu de donn√©es `df` qui comprend les `r length(names(df))` variables suivantes\ : `r names(df)`. 

```{r}
summary(df)
```


- R√©alisez une matrice de corr√©lation avec l'indice de Pearson.

```{r correlation-prep}
set.seed(43)
# duplicated chunk : correlation-init
min <- 5
max <- 15

df <- tibble(
  x = seq(from = min, to = max, by = 0.25),
  y = x*2 + rnorm(sd= 0.5, n = length(x)),
  z = 2^x + rnorm(sd= 50, n = length(x)),
  a = sin(x) + rnorm(sd = 0.25,  n = length(x)),
  id = paste0("A", 1:length(x))
)

#correlation(df[1:4])
#correlation(df[1:4], method = "spearman")
```

üí¨ *Un snippet peut vous aider √† r√©aliser cet exercice.*

```{r corr1_h3, exercise=TRUE, exercise.lines=2, exercise.setup="correlation-prep"}
correlation(___[, ___:___], use = ___, method = ___)
```

```{r corr1_h3-hint-1}
##Snippet utile ## .escor: correlation matrix (enhanced) [SciViews]
correlation(DF[, INDEX_EXPRESSION], use = "complete.obs", method = "pearson")

# Relisez le chapitre 12 du livre science des donn√©es 1 <https://wp.sciviewg/sdd-umons/>
```

```{r corr1_h3-hint-2}
correlation(df[, ___:___], use = "complete.obs", method = "pearson")

#### ATTENTION: Hint suivant = solution !####
```

```{r corr1_h3-solution}
## Solution ##
correlation(df[, 1:4], use = "complete.obs", method = "pearson")
```

```{r corr1_h3-check}
grade_code("Vous avez compris comment r√©aliser une matrice de corr√©lation.")
```

R√©pondez √† la question ci-dessous.

```{r qu_corr1}
question("Quelles sont les combinaisons de variables les plus corr√©l√©es ?",
  answer("x-y", correct = TRUE),
  answer("x-z"),
  answer("x-a"),
  answer("y-z"),
  answer("y-a"),
  answer("z-a"),
  allow_retry = TRUE, random_answer_order = TRUE)
```

- R√©alisez une matrice de corr√©lation avec la m√©thode de Spearman.

üí¨ **Un snippet peut vous aider √† r√©aliser cet exercice.**

```{r corr2_h3, exercise=TRUE, exercise.lines=2,  exercise.setup="correlation-prep"}
correlation(___[, ___:___], use = ___, method = ___)
```

```{r corr2_h3-hint-1}
##Snippet utile ## .escor: correlation matrix (enhanced) [SciViews]
correlation(DF[, INDEX_EXPRESSION], use = "complete.obs", method = "pearson")

# Relisez le chapitre 12 du livre science des donn√©es 1 <https://wp.sciviewg/sdd-umons/>
```

```{r corr2_h3-hint-2}
correlation(df[, ___:___], use = "complete.obs", method = "spearman")

#### ATTENTION: Hint suivant = solution !####
```

```{r corr2_h3-solution}
## Solution ##
correlation(df[, 1:4], use = "complete.obs", method = "spearman")
```

```{r corr2_h3-check}
grade_code("C'est cela. Rappelez-vous bien la diff√©rence entre Spearman (corr√©lation non lin√©aire) et Pearson (corr√©lation lin√©aire).")
```

R√©pondez √† la question ci-dessous

```{r qu_corr2}
question("Quelles sont les combinaisons de variables les moins corr√©l√©es ?",
  answer("x-y"),
  answer("x-z"),
  answer("x-a"),
  answer("y-z"),
  answer("y-a", correct = TRUE),
  answer("z-a"),
    allow_retry = TRUE, random_answer_order = TRUE
  )
```

- Reproduisez le graphique ci-dessous en vous basant sur vos matrices r√©alis√©es pr√©c√©demment

```{r, echo=FALSE}
plot(correlation(df[, 2:4], use = "complete.obs", method = "pearson"), type = "upper")
```

```{r corr3_h3, exercise=TRUE, exercise.lines=2, exercise.setup="correlation-prep"}
correlation(___[,___:___], use = ___, method = ___)
```

```{r corr3_h3-hint-1}
plot(correlation(___[,___:___], use = ___, method = ___), type = ____)
```

```{r corr3_h3-hint-2}
plot(correlation(___[,___:____], use = ___, method = ___), type = "upper")

#### ATTENTION: Hint suivant = solution !####
```

```{r corr3_h3-solution}
plot(correlation(df[, 2:4], use = "complete.obs", method = "pearson"), type = "upper")
```

```{r corr3_h3-check}
grade_code("Pr√©senter une matrice de corr√©lation sous la forme d'un graphique, c'est quand m√™me plus convivial.")
```

## R√©gression lin√©aire

```{r reglin1_init}
set.seed(42)
x <- seq(from = 5, to = 15, by = 0.25)
a <- x * 1.0 + 3 + rnorm(sd = 0.5, n = length(x))
b <- x * 1.1 + 3 + rnorm(sd = 0.5, n = length(x))
c <- x * 1.2 + 3 + rnorm(sd = 0.5, n = length(x))

area <- as.factor(rep(c("a", "b", "c"), each = length(x)))

maize <- tibble(
  x = c(x, x, x),
  value = c(a, b, c),
  area = area
)

lm_reg <- lm(data = maize, value ~ x)

lm_param <- broom::glance(lm_reg)
lm_result <- broom::tidy(lm_reg)
```

R√©alisez la r√©gression lin√©aire de `value` en fonction de `x` sur le jeu de donn√©es `maize` (des donn√©es dont il n'est pas important de conna√Ætre l'origine ni la signification pour l'exercice, et mesur√©es sur des plans de ma√Øs). Le graphique en nuage de points permet de visualiser les donn√©es.

```{r}
chart(data = maize, value ~ x) +
  geom_point()
```

```{r reglin1-prep}
set.seed(42)
x <- seq(from = 5, to = 15, by = 0.25)
  
a <- x*1 + 3 + rnorm(sd = 0.5, n = length(x))
b <- x*1.1 + 3 + rnorm(sd = 0.5, n = length(x))
c <- x*1.2 + 3 + rnorm(sd = 0.5, n = length(x))

area <- as.factor(rep(c("a", "b", "c"), each = length(x)))

maize <- tibble(
  x = c(x, x, x),
  value = c(a, b, c),
  area = area
)
```

üí¨ **Un snippet peut vous aider √† r√©aliser cet exercice.**

```{r reglin1_h2, exercise=TRUE, exercise.lines=2, exercise.setup="reglin1-prep"}
summary(lm. <- lm(data = ___, ___ ~ ___))
```

```{r reglin1_h2-hint-1}
##Snippet utile ## .mlin: linear model
summary(lm. <- lm(data = DF, FORMULA))

#### ATTENTION: Hint suivant = solution !####
```

```{r reglin1_h2-solution}
##Solution##
summary(lm. <- lm(data = maize, value ~ x))
```

```{r reglin1_h2-check}
grade_code("Vous avez r√©alis√© votre premier mod√®le lin√©aire.")
```

Suite √† votre analyse r√©pondez aux questions suivantes\ :

```{r qu_reglin1}
quiz(
  question(text = "Quelle est la valeur de l'ordonn√©e √† l'origine ?",
    answer(sprintf("%.2f", lm_result$estimate[1]), correct = TRUE),
    answer(sprintf("%.2f", lm_result$estimate[2])),
    answer(sprintf("%.2f", lm_result$std.error[1])),
    answer(sprintf("%.2f", lm_result$std.error[2])),
    answer(sprintf("%.2f", lm_result$statistic[1])),
    answer(sprintf("%.2f", lm_result$statistic[2])),
    answer(sprintf("%.2f", lm_param$r.squared[1])),
    allow_retry = TRUE, random_answer_order = TRUE),
  question(text = "Quelle est la valeur de la pente ?",
    answer(sprintf("%.2f", lm_result$estimate[1])),
    answer(sprintf("%.2f", lm_result$estimate[2]), correct = TRUE),
    answer(sprintf("%.2f", lm_result$std.error[1])),
    answer(sprintf("%.2f", lm_result$std.error[2])),
    answer(sprintf("%.2f", lm_result$statistic[1])),
    answer(sprintf("%.2f", lm_result$statistic[2])),
    answer(sprintf("%.2f", lm_param$r.squared[1])),
    allow_retry = TRUE, random_answer_order = TRUE),
  question(text = "Est ce que la valeur de l'ordonn√©e √† l'origne est significativement diff√©rente de z√©ro ?",
    answer("oui", correct = TRUE),
    answer("non"),
    allow_retry = TRUE),
  question(
    text = "Est ce que la valeur de la pente est significativement diff√©rente de z√©ro ?",
    answer("oui", correct = TRUE),
    answer("non"),
    allow_retry = TRUE)
)
```

## Conclusion

Votre auto-√©valuation concernant la r√©gression lin√©aires dans R (premi√®re partie) arrive √† son terme. Il est temps de revenir au syllabus et de poursuivre vers des exercices pratiques maintenant.

```{r comm_noscore, echo=FALSE}
question_text(
  "Laissez-nous vos impressions sur ce learnr",
  answer("", TRUE, message = "Pas de commentaires... C'est bien aussi."),
  incorrect = "Vos commentaires sont enregistr√©s.",
  placeholder = "Entrez vos commentaires ici...",
  allow_retry = TRUE
)
```
