---
title: "R√©gression lin√©aire multiple"
author: "Guyliann Engels & Philippe Grosjean"
description: "**SDD II Module 2** Aborder la r√©gression lin√©aire multiple dans R."
tutorial:
  id: "B02La_reg_multi"
  version: 2.2.1/7
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
BioDataScience2::learnr_setup()
SciViews::R()
```

```{r, echo=FALSE}
BioDataScience2::learnr_banner()
```

```{r, context="server"}
BioDataScience2::learnr_server(input, output, session)
```

------------------------------------------------------------------------

**Ce tutoriel correspond √† la version 2021-2022. Il est en cours de r√©vision pour la version 2022-2023. Vous devez probablement penser √† installer une version plus r√©cente du package qui contient les exercices finalis√©s¬†!**

## Objectifs

-   √ätre capable de lire la sortie renvoy√©e par `summary()` lorsqu'il est appliqu√© √† un objet **lm**.
-   Ma√Ætriser la r√©gression lin√©aire multiple dans R avec la fonction `lm()`.

## R√©gression lin√©aire

R√©alisez une r√©gression lin√©aire simple sur le jeu de donn√©es `df1` de la variable `y` en fonction de la variable `x`.

```{r reglin-init}
set.seed(42)

reg_lin <- function(x, a, b)
  a * x + b

v1 <- seq(from = 5, to = 20, by = 0.25)
v2 <- v1 + rnorm(length(v1), sd = 0.5)

df1 <- dtx(
  x = v2,
  y = reg_lin(v2, 0.5, 0.001) + rnorm(length(v1), sd = 0.5)
)

lm_lin <- lm(data = df1, y ~ x)
lm_lin_param <- glance(lm_lin)
lm_lin_result <- tidy(lm_lin)
```

Vous avez √† votre disposition le graphique suivant pour visualiser les donn√©es¬†:

```{r}
chart(data = df1, y ~ x) +
  geom_point() 
```

```{r reglin-prep}
set.seed(42)

reg_lin <- function(x, a, b)
  a * x + b

v1 <- seq(from = 5, to = 20, by = 0.25)
v2 <- v1 + rnorm(length(v1), sd = 0.5)

df1 <- dtx(
  x = v2,
  y = reg_lin(v2, 0.5, 0.001) + rnorm(length(v1), sd = 0.5)
)

lm_lin <- lm(data = df1, y ~ x)
lm_lin_param <- glance(lm_lin)
lm_lin_result <- tidy(lm_lin)
```

üí¨ **Un snippet peut vous aider √† r√©aliser cet exercice.**

```{r reglin_h2, exercise = TRUE, exercise.setup = "reglin-prep"}
summary(lm. <- lm(data = ___, ___ ~ ___))
```

```{r reglin_h2-hint}
summary(lm. <- lm(data = DF, FORMULA))

#### ATTENTION: Hint suivant = solution !####
```

```{r reglin_h2-solution}
## Solution ##
summary(lm. <- lm(data = df1, y ~ x))
```

```{r reglin_h2-check}
grade_code("D'accord, on a maintenant une r√©gression lin√©aire simple comme point de d√©part.")
```

Suite √† votre analyse r√©pondez aux questions suivantes¬†:

```{r qu_reglin}
quiz(
  question(text = "Quelle est la valeur de l'ordonn√©e √† l'origine ?",
    answer(sprintf("%.2f", lm_lin_result$estimate[1]), correct = TRUE),
    answer(sprintf("%.2f", 0)),
    answer(sprintf("%.2f", lm_lin_param$sigma[1])),
    answer(sprintf("%.2f", lm_lin_result$estimate[2])),
    answer(sprintf("%.2f", lm_lin_param$r.squared[1])),
    allow_retry = TRUE, random_answer_order = TRUE
  ),
  question(text = "Quelle est la valeur de la pente ?",
    answer(sprintf("%.2f", 0)),
    answer(sprintf("%.2f", lm_lin_result$estimate[2]), correct = TRUE),
    answer(sprintf("%.2f", lm_lin_param$BIC[1])),
    answer(sprintf("%.2f", lm_lin_result$estimate[1])),
    answer(sprintf("%.2f", lm_lin_param$r.squared[1])),
    allow_retry = TRUE, random_answer_order = TRUE
  ),
  question(text = "Quelle est la fraction de la variance exprim√©e par la r√©gression lin√©aire ?",
    answer(sprintf("%.3f", lm_lin_param$r.squared), correct = TRUE),
    answer(sprintf("%.3f", lm_lin_param$statistic)),
    answer(sprintf("%.3f", as.numeric(lm_lin_param$df))),
    answer(sprintf("%.3f", lm_lin_result$estimate[1])),
    allow_retry = TRUE, random_answer_order = TRUE
  )
)
```

## R√©gression lin√©aire multiple

```{r regmulti-init}
set.seed(381)

v <- seq(from = 1, to = 15, by = .2) 
x <- v + rnorm(length(v), sd = 3)

reg_lin_rand <- function(x, a, b, random = 0.5)
  a * x + b + rnorm(length(v), sd = random)
  
reg_mutli3_rand <- function(x1, a1, x2, a2, x3, a3, b, random = 5)
  a1 * x1 + a2 * x2 + a3 * x3 + b + rnorm(length(x1), sd = random)

df2 <- dtx(
  x  = x,
  x0 = reg_lin_rand(x = x, a = 1.26, b = 2, random = 3.5),
  x1 = reg_lin_rand(x = x, a = 1.5, b = 1, random = 10),
  y  = reg_mutli3_rand(x1 = x, x2 = x0,  x3 = x1,
    a1 = 0.2, a2 = 0.3, a3 = 1.1, b = 2))

lm_mult <- lm(data = df2, y  ~ x + x1)
lm_mult_coef <- tidy(lm_mult)
lm_mult_param <- glance(lm_mult)
```

```{r}
summary(df2)
```

R√©alisez une r√©gression lin√©aire simple sur le jeu de donn√©es `df2` de la variable `y` en fonction de la variable `x` et `x1`.

```{r regmulti-prep}
set.seed(381)

v <- seq(from = 1, to = 15, by = .2) 
x <- v + rnorm(length(v), sd = 3)

reg_lin_rand <- function(x, a, b, random = 0.5)
  a * x + b + rnorm(length(v), sd = random)
  
reg_mutli3_rand <- function(x1, a1, x2, a2, x3, a3, b, random = 5)
  a1 * x1 + a2 * x2 + a3 * x3 + b + rnorm(length(x1), sd = random)

df2 <- dtx(
  x  = x,
  x0 = reg_lin_rand(x = x, a = 1.26, b = 2, random = 3.5),
  x1 = reg_lin_rand(x = x, a = 1.5, b = 1, random = 10),
  y  = reg_mutli3_rand(x1 = x, x2 = x0,  x3 = x1,
    a1 = 0.2, a2 = 0.3, a3 = 1.1, b = 2))

lm_mult <- lm(data = df2, y  ~ x + x1)
lm_mult_coef <- tidy(lm_mult)
lm_mult_param <- glance(lm_mult)
```

üí¨ **Un snippet peut vous aider √† r√©aliser cet exercice.**

```{r regmulti_h2, exercise = TRUE, exercise.setup = "regmulti-prep"}
# r√©gression multiple 
summary(lm. <- lm(data = ___, ___ ~ ___))
```

```{r regmulti_h2-hint}
summary(lm. <- lm(data = DF, Y  ~ VAR1 + VAR2))

#### ATTENTION: Hint suivant = solution !####
```

```{r regmulti_h2-solution}
## Solution ## 
summary(lm. <- lm(data = df2, y ~ x + x1))
```

```{r regmulti_h2-check}
grade_code("Vous venez de r√©aliser votre premi√®re r√©gression lin√©aire multiple. Elles n'auront bient√¥t plus de secrets pour vous !")
```

Suite √† votre analyse r√©pondez aux questions suivantes¬†:

```{r qu_regmulti}
quiz(
  question(text = "Quelle est la valeur de l'ordonn√©e √† l'origine ?",
    answer(sprintf("%.2f", lm_mult_coef$estimate[1]), correct = TRUE),
    answer(sprintf("%.2f", lm_mult_coef$estimate[2])),
    answer(sprintf("%.2f", lm_mult_coef$p.value[1])),
    answer(sprintf("%.2f", lm_mult_param$AIC[1])),
    answer(sprintf("%.2f", lm_mult_param$r.squared[1])),
    allow_retry = TRUE, random_answer_order = TRUE
  ),
  question(text = "Quelle est la fraction de la variance exprim√©e par la r√©gression lin√©aire ?",
    answer(sprintf("%.3f", lm_mult_param$adj.r.squared), correct = TRUE),
    answer(sprintf("%.3f", lm_mult_param$r.squared)),
    answer(sprintf("%.3f", lm_mult_param$df)),
    answer(sprintf("%.3f", lm_mult_coef$estimate[1])),
    allow_retry = TRUE, random_answer_order = TRUE
  )
)
```

## Conclusion

Vous venez de terminer votre s√©ance d'exercices relive √† la r√©gression multiple.

```{r comm_noscore, echo=FALSE}
question_text(
  "Laissez-nous vos impressions sur ce learnr",
  answer("", TRUE, message = "Pas de commentaires... C'est bien aussi."),
  incorrect = "Vos commentaires sont enregistr√©s.",
  placeholder = "Entrez vos commentaires ici...",
  allow_retry = TRUE
)
```
