---
title: "R√©gression lin√©aire polynomiale"
author: "Guyliann Engels & Philippe Grosjean"
description: "**SDD II Module 2** Ma√Ætriser la r√©gression lin√©aire polynomiale."
tutorial:
  id: "B02Lb_reg_poly"
  version: 2.0.1/7
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
BioDataScience2::learnr_setup()
SciViews::R()
```

```{r, echo=FALSE}
BioDataScience2::learnr_banner()
```

```{r, context="server"}
BioDataScience2::learnr_server(input, output, session)
```

------------------------------------------------------------------------

## Objectifs

-   Ma√Ætriser la r√©gression lin√©aire polynomiale dans R avec la fonction `lm()`.
-   Utiliser le **crit√®re d'Akaike** pour comparer deux mod√®les.

## R√©gression lin√©aire polynomiale

```{r regpoly-init}
set.seed(42)

x <- seq(from = 1, to = 10, by = 0.25)
x1 <- x + rnorm(length(x))

mod_poly2 <- function(x1, alpha1, alpha2, intercept, random_effect){
  y <- intercept + (alpha1 * x1) + (alpha2 * (x1^2)) 
  y + rnorm(n = length(x1), sd = random_effect)
}

df <- dtx(
  x = x1,
  y = mod_poly2(x1 = x1, alpha1 = 2, alpha2 = 2.5, intercept = 55, random_effect = 10)
)

lm_poly <- lm(df, formula = y ~ x + I(x^2))
lm_poly_coef <- tidy(lm_poly)
lm_poly_param <- glance(lm_poly)
```

R√©alisez la **r√©gression lin√©aire polynomiale d'ordre 2** de la variable `y` en fonction de la variable `x` sur le jeu de donn√©es `df` et repr√©sentez-la graphiquement. Vous avez √† votre disposition un nuage de points et un r√©sum√© des donn√©es pour en connaissance.

```{r}
chart(df, y ~ x) +
  geom_point()
```

```{r regpoly-prep}
set.seed(42)

x <- seq(from = 1, to = 10, by = 0.25)
x1 <- x + rnorm(length(x))

mod_poly2 <- function(x1, alpha1, alpha2, intercept, random_effect){
  y <- intercept + (alpha1 * x1) + (alpha2 * (x1^2)) 
  y + rnorm(n = length(x1), sd = random_effect)
}

df <- dtx(
  x = x1,
  y = mod_poly2(x1 = x1, alpha1 = 2, alpha2 = 2.5, intercept = 55, random_effect = 10)
)
```

üí¨ **Un snippet peut vous aider √† r√©aliser cet exercice.**

```{r regpoly_h2, exercise = TRUE, exercise.setup = "regpoly-prep"}
summary(lm. <- lm(data = ___, ___ ~ ___))

lm. %>.% (function(lm, model = lm[["model"]], vars = names(model))
  chart(model, aes_string(x = vars[2], y = vars[1])) +
  geom_point() +
  stat_smooth(method = "lm", formula = y ~ x + I(x^2)))(.)
```

```{r regpoly_h2-hint}
# Voyez les snippets, vous y trouverez ceci :
summary(lm. <- lm(data = DF, YNUM ~  XNUM + I(XNUM^2)))

lm. %>.% (function(lm, model = lm[["model"]], vars = names(model))
  chart(model, aes_string(x = vars[2], y = vars[1])) +
  geom_point() +
  stat_smooth(method = "lm", formula = y ~ x + I(x^2)))(.)

#### ATTENTION: Hint suivant = solution !####
```

```{r regpoly_h2-solution}
## Solution ##
summary(lm. <- lm(data = df, y ~ x + I(x^2)))

lm. %>.% (function(lm, model = lm[["model"]], vars = names(model))
  chart(model, aes_string(x = vars[2], y = vars[1])) +
  geom_point() +
  stat_smooth(method = "lm", formula = y ~ x + I(x^2)))(.)
```

```{r regpoly_h2-check}
grade_code("Magnifique premi√®re r√©gression polynomiale !")
```

Suite √† votre analyse r√©pondez aux questions suivantes :

```{r qu_regpoly}
quiz(
  question(text = "Quelle est la valeur de l'ordonn√©e √† l'origine ?",
    answer(sprintf("%.2f", lm_poly_coef$estimate[1]), correct = TRUE),
    answer(sprintf("%.2f", lm_poly_coef$estimate[2])),
    answer(sprintf("%.2f", lm_poly_coef$std.error[1])),
    answer(sprintf("%.2f", lm_poly_coef$std.error[2])),
    answer(sprintf("%.2f", lm_poly_coef$statistic[1])),
    answer(sprintf("%.2f", lm_poly_coef$statistic[2])),
    answer(sprintf("%.2f", lm_poly_param$r.squared[1])),
    allow_retry = TRUE, random_answer_order = TRUE
    ),
  question(text = "Quelle est la valeur du param√®tre associ√© √† **x** ?",
    answer(sprintf("%.2f", lm_poly_coef$estimate[1])),
    answer(sprintf("%.2f", lm_poly_coef$estimate[2]), correct = TRUE),
    answer(sprintf("%.2f", lm_poly_coef$std.error[1])),
    answer(sprintf("%.2f", lm_poly_coef$std.error[2])),
    answer(sprintf("%.2f", lm_poly_coef$statistic[1])),
    answer(sprintf("%.2f", lm_poly_coef$statistic[2])),
    answer(sprintf("%.2f", lm_poly_param$r.squared[1])),
    allow_retry = TRUE, random_answer_order = TRUE
    )
)
```

## R√©gression lin√©aire simple ou polynomiale

```{r regpoly_simp-init}
set.seed(42)

x <- seq(from = 1, to = 10, by = 0.25)
x1 <- x + rnorm(length(x))

mod_poly2 <- function(x1, alpha1, alpha2, intercept, random_effect){
  y <- intercept + (alpha1 * x1) + (alpha2 * (x1^2)) 
  y + rnorm(n = length(x1), sd = random_effect)
}

df <- dtx(
  x = x1,
  y = mod_poly2(x1 = x1, alpha1 = 2, alpha2 = 2.5, intercept = 55, random_effect = 10)
)

lm_lin_simp <- lm(df, formula = y ~ x )
lm_ls_coef <- tidy(lm_lin_simp)
lm_ls_param <- glance(lm_lin_simp)

lm_lin_poly <- lm(df, formula = y ~ x + I(x^2))
lm_lp_coef <- tidy(lm_poly)
lm_lp_param <- glance(lm_poly)
```

R√©alisez une r√©gression **lin√©aire simple** et une r√©gression **lin√©aire polynomiale d'ordre 2** de la variable `y` en fonction de la variable `x` dans le jeu de donn√©es `df`. Utilisez le crit√®re d'Akaike afin de d√©terminer quel est le meilleur mod√®le. Vous avez √† votre disposition un nuage de points et un r√©sum√© des donn√©es pour en prendre connaissance.

```{r}
chart(df, y ~ x) +
  geom_point()
```

```{r regpoly_simp-prep}
set.seed(42)

x <- seq(from = 1, to = 10, by = 0.25)
x1 <- x + rnorm(length(x))

mod_poly2 <- function(x1, alpha1, alpha2, intercept, random_effect){
  y <- intercept + (alpha1 * x1) + (alpha2 * (x1^2)) 
  y + rnorm(n = length(x1), sd = random_effect)
}

df <- dtx(
  x = x1,
  y = mod_poly2(x1 = x1, alpha1 = 2, alpha2 = 2.5, intercept = 55, random_effect = 10)
)

lm_lin_simp <- lm(df, formula = y ~ x )
lm_ls_coef <- tidy(lm_lin_simp)
lm_ls_param <- glance(lm_lin_simp)

lm_lin_poly <- lm(df, formula = y ~ x + I(x^2))
lm_lp_coef <- tidy(lm_lin_poly)
lm_lp_param <- glance(lm_lin_poly)
```

üí¨ **Un snippet peut vous aider √† r√©aliser cet exercice.**

```{r regpoly_simp_h3, exercise = TRUE, exercise.setup = "regpoly_simp-prep"}
# r√©gression lin√©aire simple
summary(lm_lin_simp <- lm(data = ___, ___ ~  ___ ))
# r√©gression lin√©aire polynomiale
summary(lm_lin_poly <- lm(data = ___, ___ ~  ___ ))
# comparaison des 2 mod√®les
___(lm_lin_simp, lm_lin_poly)
```

```{r regpoly_simp_h3-hint-1}
# r√©gression lin√©aire simple (snippet 1)
summary(lm. <- lm(data = DF, YNUM ~ XNUM))
# r√©gression lin√©aire polynomiale (snippet 2)
summary(lm. <- lm(data = DF, YNUM ~  XNUM + I(XNUM^2)))
# comparaison des 2 mod√®les
___(lm_lin_simp, lm_lin_poly)

#### ATTENTION: Hint suivant = solution !####
```

```{r regpoly_simp_h3-solution}
# r√©gression lin√©aire simple
summary(lm_lin_simp <- lm(data = df, y ~ x ))
# r√©gression lin√©aire polynomiale
summary(lm_lin_poly <- lm(data = df, y ~ x + I(x^2)))
# comparaison des 2 mod√®les
AIC(lm_lin_simp, lm_lin_poly)
```

```{r regpoly_simp_h3-check}
grade_code("Vous venez de r√©aliser votre premi√®re comparaison de mod√®le. Lequel est le meilleur ?")
```

Suite √† votre analyse r√©pondez aux questions suivantes¬†:

```{r qu_regpoly_simp}
quiz(
  question(text = "Quelle est la valeur du crit√®re d'Akaike de la r√©gression polynomiale ?",
    answer(sprintf("%.2f", lm_lp_param$AIC), correct = TRUE),
    answer(sprintf("%.2f", lm_lp_param$BIC)),
    answer(sprintf("%.2f", lm_ls_param$AIC)),
    answer(sprintf("%.2f", lm_lp_param$deviance)),
    allow_retry = TRUE, random_answer_order = TRUE),
  question(text = "Quelle est la valeur du crit√®re d'Akaike de la r√©gression lin√©aire simple ?",
    answer(sprintf("%.2f", lm_ls_param$AIC), correct = TRUE),
    answer(sprintf("%.2f", lm_ls_param$BIC)),
    answer(sprintf("%.2f", lm_lp_param$AIC)),
    answer(sprintf("%.2f", lm_ls_param$deviance)),
    allow_retry = TRUE, random_answer_order = TRUE),
  question(text = "Quel est le meilleur mod√®le selon le crit√®re d'Akaike",
    answer("mod√®le lin√©aire polynomiale", correct = TRUE),
    answer("mod√®le lin√©aire simple"),
    allow_retry = TRUE)
)
```

## Conclusion

Vous venez de terminer votre s√©ance d'exercices.

```{r comm_noscore, echo=FALSE}
question_text(
  "Laissez-nous vos impressions sur ce learnr",
  answer("", TRUE, message = "Pas de commentaires... C'est bien aussi."),
  incorrect = "Vos commentaires sont enregistr√©s.",
  placeholder = "Entrez vos commentaires ici...",
  allow_retry = TRUE
)
```
