---
title: "R√©gression lin√©aire simple"
author: "Guyliann Engels & Philippe Grosjean"
description: "**[SDD II Module 1](https://wp.sciviews.org/sdd-umons2/?iframe=wp.sciviews.org/sdd-umons2-2020/r%25C3%25A9gression-lin%25C3%25A9aire-simple.html)** Application des concepts li√©s la r√©gression lin√©aire simple."
tutorial:
  id: "B01b_reg_lin"
  version: 2.0.2/10
output: 
  learnr::tutorial:
    progressive: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
BioDataScience2::learnr_setup()
SciViews::R()
```

```{r, echo=FALSE}
BioDataScience2::learnr_banner()
```

```{r, context="server"}
BioDataScience2::learnr_server(input, output, session)
```

----

## Objectifs

- Utiliser les outils de la r√©gression lin√©aire, en particulier la fonction lm().

## Corr√©lation 

```{r correlation-init}
set.seed(43)

min <- 5
max <- 15

df <- tibble(
  x = seq(from = min, to = max, by = 0.25),
  y = x*2 + rnorm(sd= 0.5, n = length(x)),
  z = 2^x + rnorm(sd= 50, n = length(x)),
  a = sin(x) + rnorm(sd = 0.25,  n = length(x)),
  id = paste0("A", 1:length(x))
)
```

Vous avez √† disposition le jeu de donn√©es `df` qui comprend les `r length(names(df))` variables suivantes : `r names(df)`. 

- R√©alisez une matrice de corr√©lation avec l'indice de Pearson.

```{r correlation-prep}
set.seed(43)
# duplicated chunk : correlation-init
min <- 5
max <- 15

df <- tibble(
  x = seq(from = min, to = max, by = 0.25),
  y = x*2 + rnorm(sd= 0.5, n = length(x)),
  z = 2^x + rnorm(sd= 50, n = length(x)),
  a = sin(x) + rnorm(sd = 0.25,  n = length(x)),
  id = paste0("A", 1:length(x))
)

#correlation(df[1:4])
#correlation(df[1:4], method = "spearman")
```

üí¨ *Un snippet peut vous aider √† r√©aliser cet exercice.*

```{r corr1_h3, exercise = TRUE, exercise.setup = "correlation-prep"}
correlation(___[, ___], use = ___, method = ___)
```

```{r corr1_h3-hint-1}
##Snippet utile ## .escor: correlation matrix (enhanced) [SciViews]
correlation(DF[, INDEX_EXPRESSION], use = "complete.obs", method = "pearson")
# Relisez le chapitre 12 du livre science des donn√©es 1 <https://wp.sciviewg/sdd-umons/>
```

```{r corr1_h3-hint-2}
correlation(df[, ___:___], use = "complete.obs", method = "pearson")
#### ATTENTION: Hint suivant = solution !####
```

```{r corr1_h3-solution}
## Solution ##
correlation(df[, 1:4], use = "complete.obs", method = "pearson")
```

```{r corr1_h3-check}
grade_code("Vous avez compris l'utilisation de la matrice de corr√©lation.")
```

R√©pondez √† la question ci-dessous

```{r qu_corr1}
question("Quelles sont les combinaisons de variables les plus corr√©l√©es ?",
  answer("x-y", correct = TRUE),
  answer("x-z"),
  answer("x-a"),
  answer("y-z"),
  answer("y-a"),
  answer("z-a"),
    allow_retry = TRUE, random_answer_order = TRUE)
```

- R√©alisez une matrice de corr√©lation avec la m√©thode de Spearman

üí¨ *Un snippet peut vous aider √† r√©aliser cet exercice.*

```{r corr2_h3, exercise = TRUE, exercise.setup = "correlation-prep"}
correlation(___[, ___], use = ___, method = ___)
```

```{r corr2_h3-hint-1}
##Snippet utile ## .escor: correlation matrix (enhanced) [SciViews]
correlation(DF[, INDEX_EXPRESSION], use = "complete.obs", method = "pearson")
# Relisez le chapitre 12 du livre science des donn√©es 1 <https://wp.sciviewg/sdd-umons/>
```

```{r corr2_h3-hint-2}
correlation(df[, ___:___], use = "complete.obs", method = "spearman")
#### ATTENTION: Hint suivant = solution !####
```

```{r corr2_h3-solution}
## Solution ##
correlation(df[, 1:4], use = "complete.obs", method = "spearman")
```

```{r corr2_h3-check}
grade_code("Vous avez compris la diff√©rence entre Spearman et Pearson")
```

R√©pondez √† la question ci-dessous

```{r qu_corr2}
question("Quelles sont les combinaisons de variables les moins corr√©l√©es ?",
  answer("x-y"),
  answer("x-z"),
  answer("x-a"),
  answer("y-z"),
  answer("y-a", correct = TRUE),
  answer("z-a"),
    allow_retry = TRUE, random_answer_order = TRUE
  )
```

- Reproduisez le graphique ci-dessous en vous basant sur vos matrices r√©alis√©es pr√©c√©demment

```{r, echo = F}
plot(correlation(df[, 2:4], use = "complete.obs", method = "pearson"), type = "upper")
```

```{r corr3_h3, exercise = TRUE, exercise.setup = "correlation-prep"}
correlation(___[,____], use = ___, method = ___)
```

```{r corr3_h3-hint-1}
plot(correlation(___[,____], use = ___, method = ___), type = ____)
```

```{r corr3_h3-hint-2}
plot(correlation(___[,___:____], use = ___, method = ___), type = "upper")
#### ATTENTION: Hint suivant = solution !####
```

```{r corr3_h3-solution}
plot(correlation(df[, 2:4], use = "complete.obs", method = "pearson"), type = "upper")
```

```{r corr3_h3-check}
grade_code("Tu sais maintenant pr√©senter une matrice de corr√©lation sous la forme d'un graphique plus convivial.")
```

## R√©gression lin√©aire

```{r reglin_init}
set.seed(42)
x <- seq(from = 5, to = 15, by = 0.25)
a <- x*1 + 3 + rnorm(sd = 0.5, n = length(x))
b <- x*1.1 + 3 + rnorm(sd = 0.5, n = length(x))
c <- x*1.2 + 3 + rnorm(sd = 0.5, n = length(x))

area <- as.factor(rep(c("a", "b", "c"), each = length(x)))

mais <- tibble(
  x = c(x,x,x),
  value = c(a,b,c),
  area = area
)

lm_reg <- lm(data = mais, value ~ x)

lm_param <- broom::glance(lm_reg)
lm_result <- broom::tidy(lm_reg)
```

R√©alisez la r√©gression lin√©aire de `value` en fonction de `x` sur le jeu de donn√©es `mais`. Vous avez √† votre disposition un nuage de points afin de visualiser les donn√©es.

```{r}
chart(mais, value ~ x) +
  geom_point()
```

```{r reglin1-prep}
set.seed(42)
x <- seq(from = 5, to = 15, by = 0.25)
  
a <- x*1 + 3 + rnorm(sd = 0.5, n = length(x))
b <- x*1.1 + 3 + rnorm(sd = 0.5, n = length(x))
c <- x*1.2 + 3 + rnorm(sd = 0.5, n = length(x))

area <- as.factor(rep(c("a", "b", "c"), each = length(x)))

mais <- tibble(
  x = c(x,x,x),
  value = c(a,b,c),
  area = area
)
```

Vous avez √† votre disposition le snippet suivant en lien avec le mod√®le lin√©aire.

üí¨ **Un snippet peut vous aider √† r√©aliser cet exercice.**


```{r reglin1_h2, exercise = TRUE, exercise.setup = "reglin1-prep"}
summary(lm. <- lm(data = ___, ____))
```

```{r reglin1_h2-hint-1}
##Snippet utile ## .mlin: linear model
summary(lm. <- lm(data = DF, FORMULA))
#### ATTENTION: Hint suivant = solution !####
```

```{r reglin1_h2-solution}
##Solution##
summary(lm. <- lm(data = mais, value ~ x))
```

```{r reglin1_h2-check}
grade_code("Vous avez r√©alis√© votre premier mod√®le lin√©aire. R√©pondez maintenant aux questions ci-dessous.")
```

Suite √† votre analyse r√©pondez aux questions suivantes :

```{r qu_reglin1}
quiz(
  question(text = "Quelle est la valeur de l'ordonn√©e √† l'origine ?",
    answer(sprintf("%.2f", lm_result$estimate[1]), correct = TRUE),
    answer(sprintf("%.2f", lm_result$estimate[2])),
    answer(sprintf("%.2f", lm_result$std.error[1])),
    answer(sprintf("%.2f", lm_result$std.error[2])),
    answer(sprintf("%.2f", lm_result$statistic[1])),
    answer(sprintf("%.2f", lm_result$statistic[2])),
    answer(sprintf("%.2f", lm_param$r.squared[1])),
    allow_retry = TRUE, random_answer_order = TRUE
    ),
  question(text = "Quelle est la valeur de la pente ?",
    answer(sprintf("%.2f", lm_result$estimate[1])),
    answer(sprintf("%.2f", lm_result$estimate[2]), correct = TRUE),
    answer(sprintf("%.2f", lm_result$std.error[1])),
    answer(sprintf("%.2f", lm_result$std.error[2])),
    answer(sprintf("%.2f", lm_result$statistic[1])),
    answer(sprintf("%.2f", lm_result$statistic[2])),
    answer(sprintf("%.2f", lm_param$r.squared[1])),
    allow_retry = TRUE, random_answer_order = TRUE
    ),
  question(
    text = "Est ce que la valeur de l'ordonn√©e √† l'origne est significativement diff√©rent de z√©ro ?",
    answer("oui", correct = TRUE),
    answer("non"),
    allow_retry = TRUE),
  question(
    text = "Est ce que la valeur de la pente est significativement diff√©rente de z√©ro ?",
    answer("oui", correct = TRUE),
    answer("non"),
    allow_retry = TRUE)
)
```

## Conclusion

Vous venez de terminer votre s√©ance d'exercice de r√©vision.

```{r comm_noscore, echo=FALSE}
question_text(
  "Laissez-nous vos impressions sur ce learnr",
  answer("", TRUE, message = "Pas de commentaires... C'est bien aussi."),
  incorrect = "Vos commentaires sont enregistr√©s.",
  placeholder = "Entrez vos commentaires ici...",
  allow_retry = TRUE
)
```
