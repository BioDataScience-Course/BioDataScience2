---
title: "Analyse factorielle des correspondances (AFC)"
author: "Guyliann Engels & Philippe Grosjean"
description: "**SDD II Module 7** Analyse Factorielle des Correspondances."
tutorial:
  id: "B07Lb_ca"
version: 2.0.1/4
output:
  learnr::tutorial:
  progressive: true
allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
BioDataScience2::learnr_setup()
SciViews::R("explore")

# caith -----
caith <- read("caith", package = "MASS")
caith_df <- as_dtf(caith)
caith_ca <- ca(caith_df)
```

```{r, echo=FALSE}
BioDataScience2::learnr_banner()
```

```{r, context="server"}
BioDataScience2::learnr_server(input, output, session)
```

------------------------------------------------------------------------

## Objectifs

L'Analyse Factorielle des Correspondances (AFC) est une variante de l'Analyse en Composantes Principales (ACP) qui permet de traiter les variables qualitatives (deux variables qualitatives transformées en un tableau de contingence à double entrée). Elle permet aussi de traiter des variables quantitatives discrètes (entiers nuls ou positifs) comme des dénombrements d'espèces à diverses stations, ce qui s'apparente également dans un certain sens à un tableau de contingence qui croise espèce et station. Ce tutoriel vous permettra de :

-   Réaliser de manière guidée une AFC

-   Effectuer les graphiques associés à cette analyse

-   Vous préparez à interpréter par vous-même les résultats de vos AFC

Avant toute chose, assurez-vous d'avoir bien compris le contenu du [module 7](https://wp.sciviews.org/sdd-umons2/?iframe=wp.sciviews.org/sdd-umons2-2022/acp-afc.html) du cours et en particulier la [section 7.3](https://wp.sciviews.org/sdd-umons2/?iframe=wp.sciviews.org/sdd-umons2-2022/analyse-factorielle-des-correspondances.html).

## Couleur des yeux et des cheveux

L'étude porte sur 5387 personnes vivant dans l'ancienne région de Caithness, se situant au nord de l'Écosse.

```{r, echo=TRUE}
caith <- read("caith", package = "MASS")
caith
```

Le tableau de données est un tableau de contingence à double entrée. Observez les colonnes. On en dénombre `r dim(caith)[2]` colonnes. La première colonne est particulièrement intéressante en portant un nom particulier `.rownames`.

Rappelez-vous que nous retrouvons plusieurs types d'objets pour les tableaux de données : les `data.frames`, les `data.tables` ou encore les `tibbles`. Par défaut en utilisant les fonctions `SciViews`, les tableaux de données sont des `data.tables`. Vous pouvez vérifier la classe d'un objet avec la fonction `class()`.

```{r, echo=TRUE}
class(caith)
```

## Réalisation de l'ACF

Le tableau nécessaire afin de réaliser une analyse factorielle des correspondances ne doit comprendre que des valeurs numériques. La première colonne `.rownames` est donc un problème. Une solution serait de la retirer avec la fonction `sselect()`. Elle n'est cependant pas la meilleure solution. Cette colonne apporte une information très intéressante dont on ne veut pas se passer. Il est donc préférable d'employer un objet différent. Les `data.frames` supporte les noms des lignes (*rownames*).

Convertissez l'objet `caith` un `data.tables` en `data.frames` à l'aide de la fonction `as_dtf()`. Nommez ce nouvel objet `caith_df`.

```{r dtf, exercise=TRUE}
caith_df <- ___(___)
# affichez le tableau
caith_df
```

```{r dtf-solution}
caith_df <- as_dtf(caith)
# affichez le tableau
caith_df
```

```{r dtf-check}
grade_code("La conversion du tableau de données entre le `data.tables` en `data.frames` est simple avec la fonction `as_dtf()`. par defaut, la fonction reconnait la colonne .rownames et la converti en nom de ligne pour un objet de class data.frames qui les accepte.")
```

Réalisez à présent une analyse factorielle des correspondances sur l'objet `caith_df` et nommez cet objet `caith_ca`. Proposez en plus le résumé de cet objet.

```{r ca_h2, exercise=TRUE}
# AFC
___ <- ___()
# Résumé de l'objet
___(___)
```

```{r ca_h2-hint-1}
# AFC
caith_ca <- ca()
# Résumé de l'objet
___(caith_ca)
```

```{r ca_h2-solution}
# AFC
caith_ca <- ca(caith_df)
# Résumé de l'objet
summary(caith_ca)
```

```{r ca_h2-check}
grade_code("Le code est simple à réaliser. Le résumé de l'objet met en avant qu'avec les deux premiers axes ont couvre 99.6% de la variance. Le premier axe couvre plus de 86%. L'essentiel de l'information se lira sur ce seul axe.")
```

Proposez le graphique des éboulis associé à l'objet `caith_ca`

```{r scree, exercise=TRUE}
___$___()
```

```{r scree-solution}
chart$scree(caith_ca)
```

```{r scree-check}
grade_code("Ce graphique vient en complément du premier tableau proposé dans le résumé. On observe que le premier axe comprend une grande part de la variance.")
```

Proposez enfin la carte (biplot) de votre objet `caith_ca`.

```{r biplot, exercise=TRUE}
___$___()
```

```{r biplot-solution}
chart$biplot(caith_ca)
```

```{r biplot-check}
grade_code("Ce graphique va s'analyser en 3 étapes. On va d'abord s'intéresser aux yeux, puis au cheveux et enfin les deux ensembles. Faites le travail par vous même avant de vous rendre dans la section suivante pour comparer votre analyse avec celle que nous vous proposons.")
```

## Interprétation de ACF

Les instructions réalisées pour obtenir l'AFC sont assez simples, mais toute la subtilité vient de l'analyse des résultats.

```{r}
caith_df <- as_dtf(read("caith", package = "MASS"))
caith_ca <- ca(caith_df)
summary(caith_ca)
chart$biplot(caith_ca, repel = TRUE)
```

Les deux premiers axes couvrent 99.6% de la variance. Du point de vue des cheveux, on observe une transition des cheveux clairs à gauche vers les cheveux foncés à droite. Du point de vue des yeux, les yeux clairs sont à gauche et les yeux foncés à droite.

On observe la même transition du clair vers le foncé aussi bien pour les cheveux que pour les yeux. Les individus aux yeux clairs vont être liés aux cheveux clairs et les individus aux yeux foncés sont associés aux cheveux foncés.

## Conclusion

Cette AFC nous a permis d'y voir plus clair entre les différentes stations et les espèces qui y vivent. Sans rien connaître sur ces espèces, nous avons pu mettre en évidence une tendance.

Maintenant que vous avez compris la logique, que vous maîtrisez les techniques pour préparer vos données et que vous êtes capable d'écrire le code permettant de réaliser une AFC, vous pouvez appliquer tout cela dans une assignation GitHub (voir dans le cours).

```{r comm_noscore, echo=FALSE}
question_text(
  "Laissez-nous vos impressions sur cet outil pédagogique",
  answer("", TRUE, message = "Pas de commentaires... C'est bien aussi."),
  incorrect = "Vos commentaires sont enregistrés.",
  placeholder = "Entrez vos commentaires ici...",
  allow_retry = TRUE
)
```
